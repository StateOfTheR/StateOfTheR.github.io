<!DOCTYPE html>
<html lang="fr-fr">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.34" />
  <meta name="author" content="State of the R">

  
  
  
  
    
      
    
  
  <meta name="description" content="L’atelier du jour avait pour objectif la découvert du package data.table au travers d’exercises proposés lors de la dernière édition de UseR. Les slides avec les énoncés sont disponibles ici.
L’apport de notre atelier est d’avoir systématiquement essayé de traiter les questions avec - les fonctionalités R de base - les fonctionalités offertes par le tidyverse (principalement dplyr) - les fonctionnalités du package data.table
Pour les animateurs : vous êtes libre de compléter le post de blog.">

  
  <link rel="alternate" hreflang="fr-fr" href="/post/data.table/">

  


  

  
  
  <meta name="theme-color" content="#3f51b5">
  
  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="State of The R">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="State of The R">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/data.table/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="State of The R">
  <meta property="og:url" content="/post/data.table/">
  <meta property="og:title" content="Exercices autour de data.table | State of The R">
  <meta property="og:description" content="L’atelier du jour avait pour objectif la découvert du package data.table au travers d’exercises proposés lors de la dernière édition de UseR. Les slides avec les énoncés sont disponibles ici.
L’apport de notre atelier est d’avoir systématiquement essayé de traiter les questions avec - les fonctionalités R de base - les fonctionalités offertes par le tidyverse (principalement dplyr) - les fonctionnalités du package data.table
Pour les animateurs : vous êtes libre de compléter le post de blog.">
  <meta property="og:locale" content="fr-fr">
  
  <meta property="article:published_time" content="2017-10-23T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2017-10-23T00:00:00&#43;00:00">
  

  

  <title>Exercices autour de data.table | State of The R</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/"><img src="/img/phare.png" alt="State of The R"></a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#hero">
            
            <span>Accueil</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#upcoming_workshops">
            
            <span>Atelier à venir</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#past_workshops">
            
            <span>Ateliers passés</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projets">
            
            <span>Projets</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>À propos</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Exercices autour de data.table</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2017-10-23 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Oct 23, 2017
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="State of the R">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    15 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/r">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Exercices%20autour%20de%20data.table&amp;url=%2fpost%2fdata.table%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fdata.table%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fdata.table%2f&amp;title=Exercices%20autour%20de%20data.table"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fdata.table%2f&amp;title=Exercices%20autour%20de%20data.table"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Exercices%20autour%20de%20data.table&amp;body=%2fpost%2fdata.table%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <p>L’atelier du jour avait pour objectif la découvert du package <a href="https://cran.r-project.org/web/packages/data.table/index.html">data.table</a> au travers d’<a href="https://user2017.sched.com/event/Aw0L/datatable-for-beginners">exercises proposés lors de la dernière édition de UseR</a>. Les slides avec les énoncés sont <a href="https://www.google.fr/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiZv7DE6I3XAhWCuBoKHcN5CREQFggrMAA&amp;url=https%3A%2F%2Fchannel9.msdn.com%2FEvents%2FuseR-international-R-User-conferences%2FuseR-International-R-User-2017-Conference%2Fdatatable-for-beginners&amp;usg=AOvVaw3N-q_5oW0-yMm8uz9hVisu">disponibles ici</a>.</p>
<p>L’apport de notre atelier est d’avoir systématiquement essayé de traiter les questions avec - les fonctionalités <code>R</code> de <em>base</em> - les fonctionalités offertes par le <em>tidyverse</em> (principalement <em>dplyr</em>) - les fonctionnalités du package <em>data.table</em></p>
<p>Pour les animateurs : vous êtes libre de compléter le post de blog. Nous ajouteroins des comparatifs en terme de temps de calcul plus tard (peut-être).</p>
<div id="preliminaires" class="section level3">
<h3>Préliminaires</h3>
<p>C’est parti, on charge oles packages requis</p>
<pre class="r"><code>library(data.table)
library(tidyverse)</code></pre>
<p>Les exercices seront traités à l’aide de deux tables jouets, dont on propose des contreparties en - object <code>data.frame</code> - object <code>tibble</code> - object <code>data.table</code></p>
<pre class="r"><code>set.seed(20170703L)
DF1 = data.frame(id = sample(1:2, 9L, TRUE), 
                 code = sample(letters[1:3], 9, TRUE), 
                 valA = 1:9, valB = 10:18, 
                 stringsAsFactors = FALSE)
DF2 = data.frame(id = c(3L, 1L, 1L, 2L, 3L), 
                 code = c(&quot;b&quot;, &quot;a&quot;, &quot;c&quot;, &quot;c&quot;, &quot;d&quot;), 
                 mul = 5:1, stringsAsFactors = FALSE)
## corresponding data tibble
TB1 &lt;- as.tibble(DF1)
TB2 &lt;- as.tibble(DF2)
## corresponding data tables
DT1 &lt;- as.data.table(DF1)
DT2 &lt;- as.data.table(DF2)</code></pre>
</div>
<div id="question-1" class="section level3">
<h3>Question 1</h3>
<p><em>Subset all rows where id column equals 1 &amp; code column is not equal to “c”</em></p>
<div id="base" class="section level4">
<h4>base</h4>
<pre class="r"><code>base::subset(DF1, id == 1 &amp; code != &quot;c&quot;)</code></pre>
<pre><code>##   id code valA valB
## 2  1    b    2   11
## 7  1    b    7   16</code></pre>
<pre class="r"><code>with(DF1, DF1[id == 1 &amp; code != &quot;c&quot;,])</code></pre>
<pre><code>##   id code valA valB
## 2  1    b    2   11
## 7  1    b    7   16</code></pre>
</div>
<div id="dplyr" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>filter(TB1, id == 1 &amp; code != &quot;c&quot;)</code></pre>
<pre><code>## # A tibble: 2 x 4
##      id code   valA  valB
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1     1 b         2    11
## 2     1 b         7    16</code></pre>
</div>
<div id="data.table" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[id == 1 &amp; code != &quot;c&quot;] </code></pre>
<pre><code>##    id code valA valB
## 1:  1    b    2   11
## 2:  1    b    7   16</code></pre>
</div>
</div>
<div id="question-2" class="section level3">
<h3>Question 2</h3>
<p><em>Select valA and valB columns from DF1</em></p>
<div id="base-r" class="section level4">
<h4>base R</h4>
<pre class="r"><code>DF1[, c(&quot;valA&quot;, &quot;valB&quot;)]</code></pre>
<pre><code>##   valA valB
## 1    1   10
## 2    2   11
## 3    3   12
## 4    4   13
## 5    5   14
## 6    6   15
## 7    7   16
## 8    8   17
## 9    9   18</code></pre>
</div>
<div id="dplyr-1" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>select(TB1, valA, valB)</code></pre>
<pre><code>## # A tibble: 9 x 2
##    valA  valB
##   &lt;int&gt; &lt;int&gt;
## 1     1    10
## 2     2    11
## 3     3    12
## 4     4    13
## 5     5    14
## 6     6    15
## 7     7    16
## 8     8    17
## 9     9    18</code></pre>
</div>
<div id="data.table-1" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[ , .(valA,valB)]</code></pre>
<pre><code>##    valA valB
## 1:    1   10
## 2:    2   11
## 3:    3   12
## 4:    4   13
## 5:    5   14
## 6:    6   15
## 7:    7   16
## 8:    8   17
## 9:    9   18</code></pre>
</div>
</div>
<div id="question-3" class="section level3">
<h3>Question 3</h3>
<p><em>Get sum(valA) and sum(valB) for id &gt; 1 as a 1-row, 2-col data.frame</em></p>
<div id="base-r-1" class="section level4">
<h4>base R</h4>
<pre class="r"><code>colSums(DF1[ DF1$id &gt; 1, c(&quot;valA&quot;, &quot;valB&quot;)])</code></pre>
<pre><code>## valA valB 
##   19   46</code></pre>
</div>
<div id="dplyr-2" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% filter(id &gt; 1) %&gt;% select(valA, valB) %&gt;% summarise_all(sum)</code></pre>
<pre><code>## # A tibble: 1 x 2
##    valA  valB
##   &lt;int&gt; &lt;int&gt;
## 1    19    46</code></pre>
</div>
<div id="data.table-2" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[id &gt; 1, .(sum(valA), sum(valB))]</code></pre>
<pre><code>##    V1 V2
## 1: 19 46</code></pre>
</div>
</div>
<div id="question-4" class="section level3">
<h3>Question 4</h3>
<p><em>Replace valB with valB+1 for all rows where code == “c”</em></p>
<div id="base-r-2" class="section level4">
<h4>base R</h4>
<pre class="r"><code>DF1$valB[DF1$code==&quot;c&quot;] = DF1$valB[DF1$code==&quot;c&quot;] + 1
DF1</code></pre>
<pre><code>##   id code valA valB
## 1  1    c    1   11
## 2  1    b    2   11
## 3  1    c    3   13
## 4  1    c    4   14
## 5  2    a    5   14
## 6  2    a    6   15
## 7  1    b    7   16
## 8  2    a    8   17
## 9  1    c    9   19</code></pre>
</div>
<div id="dplyr-3" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- TB1 %&gt;% mutate(valB = ifelse(code == &quot;c&quot;, valB + 1,valB))
## TB1[TB1$code==&quot;c&quot;, ] &lt;- filter(TB1, code==&quot;c&quot;) %&gt;% mutate(valB= valB+1) # alternative solution
TB1</code></pre>
<pre><code>## # A tibble: 9 x 4
##      id code   valA  valB
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;
## 1     1 c         1  11.0
## 2     1 b         2  11.0
## 3     1 c         3  13.0
## 4     1 c         4  14.0
## 5     2 a         5  14.0
## 6     2 a         6  15.0
## 7     1 b         7  16.0
## 8     2 a         8  17.0
## 9     1 c         9  19.0</code></pre>
</div>
<div id="data.table-3" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[code == &quot;c&quot;, valB := valB + 1L]
DT1</code></pre>
<pre><code>##    id code valA valB
## 1:  1    c    1   11
## 2:  1    b    2   11
## 3:  1    c    3   13
## 4:  1    c    4   14
## 5:  2    a    5   14
## 6:  2    a    6   15
## 7:  1    b    7   16
## 8:  2    a    8   17
## 9:  1    c    9   19</code></pre>
</div>
</div>
<div id="question-5" class="section level3">
<h3>Question 5</h3>
<p><em>Add a new column valC column with values equal to valB^2 - valA^2</em></p>
<div id="base-r-3" class="section level4">
<h4>base R</h4>
<pre class="r"><code>DF1 &lt;- transform(DF1, valC = valB^2 - valA^2)
## DF1$valC &lt;- DF1$valB^2 - DF1$valA^2 # alternate solution
DF1</code></pre>
<pre><code>##   id code valA valB valC
## 1  1    c    1   11  120
## 2  1    b    2   11  117
## 3  1    c    3   13  160
## 4  1    c    4   14  180
## 5  2    a    5   14  171
## 6  2    a    6   15  189
## 7  1    b    7   16  207
## 8  2    a    8   17  225
## 9  1    c    9   19  280</code></pre>
</div>
<div id="dplyr-4" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- mutate(TB1, valC = valB^2 - valA^2)
TB1</code></pre>
<pre><code>## # A tibble: 9 x 5
##      id code   valA  valB  valC
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 c         1  11.0   120
## 2     1 b         2  11.0   117
## 3     1 c         3  13.0   160
## 4     1 c         4  14.0   180
## 5     2 a         5  14.0   171
## 6     2 a         6  15.0   189
## 7     1 b         7  16.0   207
## 8     2 a         8  17.0   225
## 9     1 c         9  19.0   280</code></pre>
</div>
<div id="data.table-4" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, valC := valB^2 - valA^2]
DT1</code></pre>
<pre><code>##    id code valA valB valC
## 1:  1    c    1   11  120
## 2:  1    b    2   11  117
## 3:  1    c    3   13  160
## 4:  1    c    4   14  180
## 5:  2    a    5   14  171
## 6:  2    a    6   15  189
## 7:  1    b    7   16  207
## 8:  2    a    8   17  225
## 9:  1    c    9   19  280</code></pre>
</div>
</div>
<div id="question-6" class="section level3">
<h3>Question 6</h3>
<p><em>Get sum(valA) and sum(valB) grouped by id and code (i.e., for each unique combination of id,code)</em></p>
<div id="base-1" class="section level4">
<h4>base</h4>
<pre class="r"><code>aggregate(.~ id + code, DF1, sum)</code></pre>
<pre><code>##   id code valA valB valC
## 1  2    a   19   46  585
## 2  1    b    9   27  324
## 3  1    c   17   57  740</code></pre>
<pre class="r"><code>aggregate(DF1[, c(&quot;valA&quot;, &quot;valB&quot;)], list(DF1$id, DF1$code), sum)</code></pre>
<pre><code>##   Group.1 Group.2 valA valB
## 1       2       a   19   46
## 2       1       b    9   27
## 3       1       c   17   57</code></pre>
</div>
<div id="dplyr-5" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% group_by(id, code) %&gt;% summarise_all(sum)</code></pre>
<pre><code>## # A tibble: 3 x 5
## # Groups:   id [?]
##      id code   valA  valB  valC
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 b         9  27.0   324
## 2     1 c        17  57.0   740
## 3     2 a        19  46.0   585</code></pre>
</div>
<div id="data.table-5" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, .(SumA=sum(valA), SumB = sum(valB)), by=list(id,code) ] </code></pre>
<pre><code>##    id code SumA SumB
## 1:  1    c   17   57
## 2:  1    b    9   27
## 3:  2    a   19   46</code></pre>
</div>
</div>
<div id="question-7" class="section level3">
<h3>Question 7</h3>
<p><em>Get sum(valA) and sum(valB) grouped by id for id &gt;= 2 &amp; code %in% c(“a”, “c”)</em></p>
<div id="base-2" class="section level4">
<h4>base</h4>
<pre class="r"><code>aggregate(.~ id , subset(DF1, id &gt;=2 &amp; code %in% c(&quot;a&quot;,&quot;c&quot;), -code), sum)</code></pre>
<pre><code>##   id valA valB valC
## 1  2   19   46  585</code></pre>
</div>
<div id="dplyr-6" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% 
  group_by(id) %&gt;% 
  filter(id &gt;=2, code %in% c(&quot;a&quot;, &quot;c&quot;)) %&gt;% 
  select(-code, -valC) %&gt;% 
  summarise_all(sum)</code></pre>
<pre><code>## # A tibble: 1 x 3
##      id  valA  valB
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1     2    19  46.0</code></pre>
</div>
<div id="data.table-6" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[ (id&gt;=2) &amp; code %in% c(&quot;a&quot;, &quot;c&quot;) , .(SumA=sum(valA), SumB = sum(valB)), by=id ] </code></pre>
<pre><code>##    id SumA SumB
## 1:  2   19   46</code></pre>
</div>
</div>
<div id="question-8" class="section level3">
<h3>Question 8</h3>
<p><em>Replace valA with max(valA)-min(valA) grouped by code</em></p>
<div id="base-3" class="section level4">
<h4>base</h4>
<pre class="r"><code>DF1 &lt;- transform(DF1, valA = rep(tapply(valA, code, function(x) diff(range(x)))[code]))
DF1</code></pre>
<pre><code>##   id code valA valB valC
## 1  1    c    8   11  120
## 2  1    b    5   11  117
## 3  1    c    8   13  160
## 4  1    c    8   14  180
## 5  2    a    3   14  171
## 6  2    a    3   15  189
## 7  1    b    5   16  207
## 8  2    a    3   17  225
## 9  1    c    8   19  280</code></pre>
</div>
<div id="dplyr-7" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- TB1 %&gt;% group_by(code) %&gt;% mutate(valA= max(valA)-min(valA))
TB1</code></pre>
<pre><code>## # A tibble: 9 x 5
## # Groups:   code [3]
##      id code   valA  valB  valC
##   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 c      8.00  11.0   120
## 2     1 b      5.00  11.0   117
## 3     1 c      8.00  13.0   160
## 4     1 c      8.00  14.0   180
## 5     2 a      3.00  14.0   171
## 6     2 a      3.00  15.0   189
## 7     1 b      5.00  16.0   207
## 8     2 a      3.00  17.0   225
## 9     1 c      8.00  19.0   280</code></pre>
</div>
<div id="data.table-7" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, &quot;valA&quot; := max(valA)-min(valA), by=code] 
DT1</code></pre>
<pre><code>##    id code valA valB valC
## 1:  1    c    8   11  120
## 2:  1    b    5   11  117
## 3:  1    c    8   13  160
## 4:  1    c    8   14  180
## 5:  2    a    3   14  171
## 6:  2    a    3   15  189
## 7:  1    b    5   16  207
## 8:  2    a    3   17  225
## 9:  1    c    8   19  280</code></pre>
</div>
</div>
<div id="question-9" class="section level3">
<h3>Question 9</h3>
<p><em>Create a new col named valD with max(valB)-min(valA) grouped by code</em></p>
<div id="base-4" class="section level4">
<h4>base</h4>
<pre class="r"><code>DF1 &lt;- transform(DF1, valD = by(DF1, code, function(x) max(x$valB) - min(x$valA))[code])
DF1</code></pre>
<pre><code>##   id code valA valB valC valD
## 1  1    c    8   11  120   11
## 2  1    b    5   11  117   11
## 3  1    c    8   13  160   11
## 4  1    c    8   14  180   11
## 5  2    a    3   14  171   14
## 6  2    a    3   15  189   14
## 7  1    b    5   16  207   11
## 8  2    a    3   17  225   14
## 9  1    c    8   19  280   11</code></pre>
</div>
<div id="dplyr-8" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- TB1 %&gt;% group_by(code) %&gt;% mutate(valD= max(valB)-min(valA))
TB1</code></pre>
<pre><code>## # A tibble: 9 x 6
## # Groups:   code [3]
##      id code   valA  valB  valC  valD
##   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 c      8.00  11.0   120  11.0
## 2     1 b      5.00  11.0   117  11.0
## 3     1 c      8.00  13.0   160  11.0
## 4     1 c      8.00  14.0   180  11.0
## 5     2 a      3.00  14.0   171  14.0
## 6     2 a      3.00  15.0   189  14.0
## 7     1 b      5.00  16.0   207  11.0
## 8     2 a      3.00  17.0   225  14.0
## 9     1 c      8.00  19.0   280  11.0</code></pre>
</div>
<div id="data.table-8" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, &quot;valD&quot; := max(valB)-min(valA), by=code] 
DT1</code></pre>
<pre><code>##    id code valA valB valC valD
## 1:  1    c    8   11  120   11
## 2:  1    b    5   11  117   11
## 3:  1    c    8   13  160   11
## 4:  1    c    8   14  180   11
## 5:  2    a    3   14  171   14
## 6:  2    a    3   15  189   14
## 7:  1    b    5   16  207   11
## 8:  2    a    3   17  225   14
## 9:  1    c    8   19  280   11</code></pre>
</div>
</div>
<div id="question-10" class="section level3">
<h3>Question 10</h3>
<p><em>Subset DF1 by DF2 on id,code column. That is, for each row of DF2$id, DF2$code, get valA and valB cols from DF1. Include rows that have no matches as well.</em></p>
<div id="base-5" class="section level4">
<h4>base</h4>
<pre class="r"><code>merge(DF1, DF2[, c(&quot;id&quot;, &quot;code&quot;)], by = c(&quot;id&quot;, &quot;code&quot;), all.y=TRUE)</code></pre>
<pre><code>##   id code valA valB valC valD
## 1  1    a   NA   NA   NA   NA
## 2  1    c    8   11  120   11
## 3  1    c    8   13  160   11
## 4  1    c    8   14  180   11
## 5  1    c    8   19  280   11
## 6  2    c   NA   NA   NA   NA
## 7  3    b   NA   NA   NA   NA
## 8  3    d   NA   NA   NA   NA</code></pre>
</div>
<div id="dplyr-9" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>right_join(TB1, TB2 %&gt;% select(id, code), by = c(&quot;id&quot;, &quot;code&quot;)) </code></pre>
<pre><code>## # A tibble: 8 x 6
## # Groups:   code [?]
##      id code   valA  valB  valC  valD
##   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3 b     NA     NA      NA  NA  
## 2     1 a     NA     NA      NA  NA  
## 3     1 c      8.00  11.0   120  11.0
## 4     1 c      8.00  13.0   160  11.0
## 5     1 c      8.00  14.0   180  11.0
## 6     1 c      8.00  19.0   280  11.0
## 7     2 c     NA     NA      NA  NA  
## 8     3 d     NA     NA      NA  NA</code></pre>
<pre class="r"><code>## inner_join to keep only rows present in tibbles, left_join to keep all rows from TB1
## anti_join to keep only rows from TB1 with no matching rows in TB2</code></pre>
</div>
<div id="data.table-9" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>merge(DT1, DT2[ , .(id, code)], all.y = TRUE)</code></pre>
<pre><code>##    id code valA valB valC valD
## 1:  1    a   NA   NA   NA   NA
## 2:  1    c    8   11  120   11
## 3:  1    c    8   13  160   11
## 4:  1    c    8   14  180   11
## 5:  1    c    8   19  280   11
## 6:  2    c   NA   NA   NA   NA
## 7:  3    b   NA   NA   NA   NA
## 8:  3    d   NA   NA   NA   NA</code></pre>
</div>
</div>
<div id="question-11" class="section level3">
<h3>Question 11</h3>
<p><em>Same as (10), but fetch just the first matching row of DF1 for each row of DF2$id, DF2$code. Exclude non-matching rows.</em></p>
<div id="base-6" class="section level4">
<h4>base</h4>
<pre class="r"><code>merge(DF1[!duplicated(DF1[, c(&quot;id&quot;, &quot;code&quot;)]), ],
      DF2[, c(&quot;id&quot;, &quot;code&quot;)], by = c(&quot;id&quot;, &quot;code&quot;))</code></pre>
<pre><code>##   id code valA valB valC valD
## 1  1    c    8   11  120   11</code></pre>
</div>
<div id="dplyr-10" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% group_by(id, code) %&gt;% slice(1) %&gt;% ## first entry in each (id, code) group
  inner_join(select(TB2, id, code), by = c(&quot;id&quot;, &quot;code&quot;))</code></pre>
<pre><code>## # A tibble: 1 x 6
## # Groups:   id, code [?]
##      id code   valA  valB  valC  valD
##   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 c      8.00  11.0   120  11.0</code></pre>
</div>
<div id="data.table-10" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>merge(DT1[, .SD[1], by = list(id, code)], ## first entry in each (id, code) group
      DT2[ , .(id, code)])</code></pre>
<pre><code>##    id code valA valB valC valD
## 1:  1    c    8   11  120   11</code></pre>
</div>
</div>
<div id="question-12" class="section level3">
<h3>Question 12</h3>
<p><em>For every row of DF2$id, DF2$code that matches with DF1’s, update valA with valA*mul.</em></p>
<div id="base-7" class="section level4">
<h4>base</h4>
<pre class="r"><code>transform(merge(DF1, DF2, by = c(&quot;id&quot;, &quot;code&quot;), all.y=TRUE), valA = valA * mul)</code></pre>
<pre><code>##   id code valA valB valC valD mul
## 1  1    a   NA   NA   NA   NA   4
## 2  1    c   24   11  120   11   3
## 3  1    c   24   13  160   11   3
## 4  1    c   24   14  180   11   3
## 5  1    c   24   19  280   11   3
## 6  2    c   NA   NA   NA   NA   2
## 7  3    b   NA   NA   NA   NA   5
## 8  3    d   NA   NA   NA   NA   1</code></pre>
</div>
<div id="dplyr-11" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>right_join(TB1, TB2, by = c(&quot;id&quot;, &quot;code&quot;)) %&gt;% mutate(valA = valA * mul)</code></pre>
<pre><code>## # A tibble: 8 x 7
## # Groups:   code [4]
##      id code   valA  valB  valC  valD   mul
##   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1     3 b      NA    NA      NA  NA       5
## 2     1 a      NA    NA      NA  NA       4
## 3     1 c      24.0  11.0   120  11.0     3
## 4     1 c      24.0  13.0   160  11.0     3
## 5     1 c      24.0  14.0   180  11.0     3
## 6     1 c      24.0  19.0   280  11.0     3
## 7     2 c      NA    NA      NA  NA       2
## 8     3 d      NA    NA      NA  NA       1</code></pre>
</div>
<div id="data.table-11" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT3 &lt;- merge(DT1, DT2, all.y = TRUE)[ , &quot;valA&quot; := valA * mul]
show(DT3) ## je ne comprends pas pourquoi il faut utiliser show pour l&#39;affichage</code></pre>
<pre><code>##    id code valA valB valC valD mul
## 1:  1    a   NA   NA   NA   NA   4
## 2:  1    c   24   11  120   11   3
## 3:  1    c   24   13  160   11   3
## 4:  1    c   24   14  180   11   3
## 5:  1    c   24   19  280   11   3
## 6:  2    c   NA   NA   NA   NA   2
## 7:  3    b   NA   NA   NA   NA   5
## 8:  3    d   NA   NA   NA   NA   1</code></pre>
</div>
</div>
<div id="question-13" class="section level3">
<h3>Question 13</h3>
<p><em>Add a new column val to DF1 with values from DF2$mul where DF2$id, DF2$code matches with DF1’s. Rows that don’t match should have NA.</em></p>
<div id="base-8" class="section level4">
<h4>base</h4>
<pre class="r"><code>transform(merge(DF1, DF2, by = c(&quot;id&quot;, &quot;code&quot;), all.x = TRUE, sort = FALSE), mul = mul)</code></pre>
<pre><code>##   id code valA valB valC valD mul
## 1  1    c    8   11  120   11   3
## 2  1    c    8   13  160   11   3
## 3  1    c    8   14  180   11   3
## 4  1    c    8   19  280   11   3
## 5  2    a    3   14  171   14  NA
## 6  1    b    5   11  117   11  NA
## 7  1    b    5   16  207   11  NA
## 8  2    a    3   17  225   14  NA
## 9  2    a    3   15  189   14  NA</code></pre>
</div>
<div id="dplyr-12" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>left_join(TB1, TB2, by = c(&quot;id&quot;, &quot;code&quot;))</code></pre>
<pre><code>## # A tibble: 9 x 7
## # Groups:   code [?]
##      id code   valA  valB  valC  valD   mul
##   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1     1 c      8.00  11.0   120  11.0     3
## 2     1 b      5.00  11.0   117  11.0    NA
## 3     1 c      8.00  13.0   160  11.0     3
## 4     1 c      8.00  14.0   180  11.0     3
## 5     2 a      3.00  14.0   171  14.0    NA
## 6     2 a      3.00  15.0   189  14.0    NA
## 7     1 b      5.00  16.0   207  11.0    NA
## 8     2 a      3.00  17.0   225  14.0    NA
## 9     1 c      8.00  19.0   280  11.0     3</code></pre>
</div>
<div id="data.table-12" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>merge(DT1, DT2, all.x = TRUE)</code></pre>
<pre><code>##    id code valA valB valC valD mul
## 1:  1    b    5   11  117   11  NA
## 2:  1    b    5   16  207   11  NA
## 3:  1    c    8   11  120   11   3
## 4:  1    c    8   13  160   11   3
## 5:  1    c    8   14  180   11   3
## 6:  1    c    8   19  280   11   3
## 7:  2    a    3   14  171   14  NA
## 8:  2    a    3   15  189   14  NA
## 9:  2    a    3   17  225   14  NA</code></pre>
</div>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/workshop">workshop</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/package">package</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/tidy">tidy</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/data.table">data.table</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/dplyr">dplyr</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/learnr/">Atelier découverte LearnR</a></li>
        
        <li><a href="/post/roscoff2017/">Finist&#39;R 2017</a></li>
        
      </ul>
    </div>
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 State of the R &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

