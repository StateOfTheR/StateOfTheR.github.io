<!DOCTYPE html>
<html lang="fr-fr">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 2.4.0">
  <meta name="generator" content="Hugo 0.58.3" />
  <meta name="author" content="State of the R">

  
  
  
  
    
  
  <meta name="description" content="L’atelier du jour avait pour objectif la découvert du package data.table au travers d’exercises proposés lors de la dernière édition de UseR. Les slides avec les énoncés sont disponibles ici.
L’apport de notre atelier est d’avoir systématiquement essayé de traiter les questions avec - les fonctionalités R de base - les fonctionalités offertes par le tidyverse (principalement dplyr) - les fonctionnalités du package data.table
Pour les animateurs : vous êtes libre de compléter le post de blog.">

  
  <link rel="alternate" hreflang="fr-fr" href="/post/data.table/">

  


  

  
  
  
  <meta name="theme-color" content="#a6bddb">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="State of The R">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="State of The R">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/data.table/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@https://twitter.com/RUG_stateofther">
  <meta property="twitter:creator" content="@https://twitter.com/RUG_stateofther">
  
  <meta property="og:site_name" content="State of The R">
  <meta property="og:url" content="/post/data.table/">
  <meta property="og:title" content="Exercices autour de data.table | State of The R">
  <meta property="og:description" content="L’atelier du jour avait pour objectif la découvert du package data.table au travers d’exercises proposés lors de la dernière édition de UseR. Les slides avec les énoncés sont disponibles ici.
L’apport de notre atelier est d’avoir systématiquement essayé de traiter les questions avec - les fonctionalités R de base - les fonctionalités offertes par le tidyverse (principalement dplyr) - les fonctionnalités du package data.table
Pour les animateurs : vous êtes libre de compléter le post de blog.">
  <meta property="og:locale" content="fr-fr">
  
  <meta property="article:published_time" content="2017-10-23T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2017-10-23T00:00:00&#43;00:00">
  

  

  

  <title>Exercices autour de data.table | State of The R</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/"><img src="/img/sticker_sotr.png" alt="State of The R"></a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#hero">
            
            <span>Accueil</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#organisation">
            
            <span>Organisation</span>
            
          </a>
        </li>

        
        

        
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
            
            <span>Ateliers</span>
            
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="nav-item">
              <a href="/#upcoming_workshops">
                
                <span>à venir</span>
                
              </a>
            </li>
            
            <li class="nav-item">
              <a href="/#past_workshops">
                
                <span>passés</span>
                
              </a>
            </li>
            
            <li class="nav-item">
              <a href="/#bootcamp">
                
                <span>bootcamp</span>
                
              </a>
            </li>
            
          </ul>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>À propos</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Exercices autour de data.table</h1>

    

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="State of the R">
  </span>
  

  <span class="article-date">
    
    <meta content="2017-10-23 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2017-10-23 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      Oct 23, 2017
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="State of the R">
  </span>

  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/workshop/">workshop</a>
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Exercices%20autour%20de%20data.table&amp;url=%2fpost%2fdata.table%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fdata.table%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fdata.table%2f&amp;title=Exercices%20autour%20de%20data.table"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fdata.table%2f&amp;title=Exercices%20autour%20de%20data.table"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Exercices%20autour%20de%20data.table&amp;body=%2fpost%2fdata.table%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      


<p>L’atelier du jour avait pour objectif la découvert du package <a href="https://cran.r-project.org/web/packages/data.table/index.html">data.table</a> au travers d’<a href="https://user2017.sched.com/event/Aw0L/datatable-for-beginners">exercises proposés lors de la dernière édition de UseR</a>. Les slides avec les énoncés sont <a href="https://www.google.fr/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiZv7DE6I3XAhWCuBoKHcN5CREQFggrMAA&amp;url=https%3A%2F%2Fchannel9.msdn.com%2FEvents%2FuseR-international-R-User-conferences%2FuseR-International-R-User-2017-Conference%2Fdatatable-for-beginners&amp;usg=AOvVaw3N-q_5oW0-yMm8uz9hVisu">disponibles ici</a>.</p>
<p>L’apport de notre atelier est d’avoir systématiquement essayé de traiter les questions avec
- les fonctionalités <code>R</code> de <em>base</em>
- les fonctionalités offertes par le <em>tidyverse</em> (principalement <em>dplyr</em>)
- les fonctionnalités du package <em>data.table</em></p>
<p>Pour les animateurs : vous êtes libre de compléter le post de blog. Nous ajouteroins des comparatifs en terme de temps de calcul plus tard (peut-être).</p>
<div id="preliminaires" class="section level3">
<h3>Préliminaires</h3>
<p>C’est parti, on charge les packages requis</p>
<pre class="r"><code>library(data.table)
library(tidyverse)</code></pre>
<p>Les exercices seront traités à l’aide de deux tables jouets, dont on propose des contreparties en
- object <code>data.frame</code>
- object <code>tibble</code>
- object <code>data.table</code></p>
<pre class="r"><code>set.seed(20170703L)
DF1 = data.frame(id = sample(1:2, 9L, TRUE), 
                 code = sample(letters[1:3], 9, TRUE), 
                 valA = 1:9, valB = 10:18, 
                 stringsAsFactors = FALSE)
DF2 = data.frame(id = c(3L, 1L, 1L, 2L, 3L), 
                 code = c(&quot;b&quot;, &quot;a&quot;, &quot;c&quot;, &quot;c&quot;, &quot;d&quot;), 
                 mul = 5:1, stringsAsFactors = FALSE)
## corresponding data tibble
TB1 &lt;- as.tibble(DF1)</code></pre>
<pre><code>## Warning: `as.tibble()` is deprecated, use `as_tibble()` (but mind the new semantics).
## This warning is displayed once per session.</code></pre>
<pre class="r"><code>TB2 &lt;- as.tibble(DF2)
## corresponding data tables
DT1 &lt;- as.data.table(DF1)
DT2 &lt;- as.data.table(DF2)</code></pre>
</div>
<div id="question-1" class="section level3">
<h3>Question 1</h3>
<p><em>Subset all rows where id column equals 1 &amp; code column is not equal to “c”</em></p>
<div id="base" class="section level4">
<h4>base</h4>
<pre class="r"><code>base::subset(DF1, id == 1 &amp; code != &quot;c&quot;)</code></pre>
<pre><code>##   id code valA valB
## 1  1    a    1   10
## 2  1    a    2   11
## 4  1    a    4   13</code></pre>
<pre class="r"><code>with(DF1, DF1[id == 1 &amp; code != &quot;c&quot;,])</code></pre>
<pre><code>##   id code valA valB
## 1  1    a    1   10
## 2  1    a    2   11
## 4  1    a    4   13</code></pre>
</div>
<div id="dplyr" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>filter(TB1, id == 1 &amp; code != &quot;c&quot;)</code></pre>
<pre><code>## # A tibble: 3 x 4
##      id code   valA  valB
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1     1 a         1    10
## 2     1 a         2    11
## 3     1 a         4    13</code></pre>
</div>
<div id="data.table" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[id == 1 &amp; code != &quot;c&quot;] </code></pre>
<pre><code>##    id code valA valB
## 1:  1    a    1   10
## 2:  1    a    2   11
## 3:  1    a    4   13</code></pre>
</div>
</div>
<div id="question-2" class="section level3">
<h3>Question 2</h3>
<p><em>Select valA and valB columns from DF1</em></p>
<div id="base-r" class="section level4">
<h4>base R</h4>
<pre class="r"><code>DF1[, c(&quot;valA&quot;, &quot;valB&quot;)]</code></pre>
<pre><code>##   valA valB
## 1    1   10
## 2    2   11
## 3    3   12
## 4    4   13
## 5    5   14
## 6    6   15
## 7    7   16
## 8    8   17
## 9    9   18</code></pre>
</div>
<div id="dplyr-1" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>select(TB1, valA, valB)</code></pre>
<pre><code>## # A tibble: 9 x 2
##    valA  valB
##   &lt;int&gt; &lt;int&gt;
## 1     1    10
## 2     2    11
## 3     3    12
## 4     4    13
## 5     5    14
## 6     6    15
## 7     7    16
## 8     8    17
## 9     9    18</code></pre>
</div>
<div id="data.table-1" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[ , .(valA,valB)]</code></pre>
<pre><code>##    valA valB
## 1:    1   10
## 2:    2   11
## 3:    3   12
## 4:    4   13
## 5:    5   14
## 6:    6   15
## 7:    7   16
## 8:    8   17
## 9:    9   18</code></pre>
</div>
</div>
<div id="question-3" class="section level3">
<h3>Question 3</h3>
<p><em>Get sum(valA) and sum(valB) for id &gt; 1 as a 1-row, 2-col data.frame</em></p>
<div id="base-r-1" class="section level4">
<h4>base R</h4>
<pre class="r"><code>colSums(DF1[ DF1$id &gt; 1, c(&quot;valA&quot;, &quot;valB&quot;)])</code></pre>
<pre><code>## valA valB 
##   30   66</code></pre>
</div>
<div id="dplyr-2" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% filter(id &gt; 1) %&gt;% select(valA, valB) %&gt;% summarise_all(sum)</code></pre>
<pre><code>## # A tibble: 1 x 2
##    valA  valB
##   &lt;int&gt; &lt;int&gt;
## 1    30    66</code></pre>
</div>
<div id="data.table-2" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[id &gt; 1, .(sum(valA), sum(valB))]</code></pre>
<pre><code>##    V1 V2
## 1: 30 66</code></pre>
</div>
</div>
<div id="question-4" class="section level3">
<h3>Question 4</h3>
<p><em>Replace valB with valB+1 for all rows where code == “c”</em></p>
<div id="base-r-2" class="section level4">
<h4>base R</h4>
<pre class="r"><code>DF1$valB[DF1$code==&quot;c&quot;] = DF1$valB[DF1$code==&quot;c&quot;] + 1
DF1</code></pre>
<pre><code>##   id code valA valB
## 1  1    a    1   10
## 2  1    a    2   11
## 3  1    c    3   13
## 4  1    a    4   13
## 5  1    c    5   15
## 6  2    a    6   15
## 7  2    a    7   16
## 8  2    c    8   18
## 9  2    b    9   18</code></pre>
</div>
<div id="dplyr-3" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- TB1 %&gt;% mutate(valB = ifelse(code == &quot;c&quot;, valB + 1,valB))
## TB1[TB1$code==&quot;c&quot;, ] &lt;- filter(TB1, code==&quot;c&quot;) %&gt;% mutate(valB= valB+1) # alternative solution
TB1</code></pre>
<pre><code>## # A tibble: 9 x 4
##      id code   valA  valB
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;
## 1     1 a         1    10
## 2     1 a         2    11
## 3     1 c         3    13
## 4     1 a         4    13
## 5     1 c         5    15
## 6     2 a         6    15
## 7     2 a         7    16
## 8     2 c         8    18
## 9     2 b         9    18</code></pre>
</div>
<div id="data.table-3" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[code == &quot;c&quot;, valB := valB + 1L]
DT1</code></pre>
<pre><code>##    id code valA valB
## 1:  1    a    1   10
## 2:  1    a    2   11
## 3:  1    c    3   13
## 4:  1    a    4   13
## 5:  1    c    5   15
## 6:  2    a    6   15
## 7:  2    a    7   16
## 8:  2    c    8   18
## 9:  2    b    9   18</code></pre>
</div>
</div>
<div id="question-5" class="section level3">
<h3>Question 5</h3>
<p><em>Add a new column valC column with values equal to valB^2 - valA^2</em></p>
<div id="base-r-3" class="section level4">
<h4>base R</h4>
<pre class="r"><code>DF1 &lt;- transform(DF1, valC = valB^2 - valA^2)
## DF1$valC &lt;- DF1$valB^2 - DF1$valA^2 # alternate solution
DF1</code></pre>
<pre><code>##   id code valA valB valC
## 1  1    a    1   10   99
## 2  1    a    2   11  117
## 3  1    c    3   13  160
## 4  1    a    4   13  153
## 5  1    c    5   15  200
## 6  2    a    6   15  189
## 7  2    a    7   16  207
## 8  2    c    8   18  260
## 9  2    b    9   18  243</code></pre>
</div>
<div id="dplyr-4" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- mutate(TB1, valC = valB^2 - valA^2)
TB1</code></pre>
<pre><code>## # A tibble: 9 x 5
##      id code   valA  valB  valC
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 a         1    10    99
## 2     1 a         2    11   117
## 3     1 c         3    13   160
## 4     1 a         4    13   153
## 5     1 c         5    15   200
## 6     2 a         6    15   189
## 7     2 a         7    16   207
## 8     2 c         8    18   260
## 9     2 b         9    18   243</code></pre>
</div>
<div id="data.table-4" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, valC := valB^2 - valA^2]
DT1</code></pre>
<pre><code>##    id code valA valB valC
## 1:  1    a    1   10   99
## 2:  1    a    2   11  117
## 3:  1    c    3   13  160
## 4:  1    a    4   13  153
## 5:  1    c    5   15  200
## 6:  2    a    6   15  189
## 7:  2    a    7   16  207
## 8:  2    c    8   18  260
## 9:  2    b    9   18  243</code></pre>
</div>
</div>
<div id="question-6" class="section level3">
<h3>Question 6</h3>
<p><em>Get sum(valA) and sum(valB) grouped by id and code (i.e., for each unique combination of id,code)</em></p>
<div id="base-1" class="section level4">
<h4>base</h4>
<pre class="r"><code>aggregate(.~ id + code, DF1, sum)</code></pre>
<pre><code>##   id code valA valB valC
## 1  1    a    7   34  369
## 2  2    a   13   31  396
## 3  2    b    9   18  243
## 4  1    c    8   28  360
## 5  2    c    8   18  260</code></pre>
<pre class="r"><code>aggregate(DF1[, c(&quot;valA&quot;, &quot;valB&quot;)], list(DF1$id, DF1$code), sum)</code></pre>
<pre><code>##   Group.1 Group.2 valA valB
## 1       1       a    7   34
## 2       2       a   13   31
## 3       2       b    9   18
## 4       1       c    8   28
## 5       2       c    8   18</code></pre>
</div>
<div id="dplyr-5" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% group_by(id, code) %&gt;% summarise_all(sum)</code></pre>
<pre><code>## # A tibble: 5 x 5
## # Groups:   id [2]
##      id code   valA  valB  valC
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 a         7    34   369
## 2     1 c         8    28   360
## 3     2 a        13    31   396
## 4     2 b         9    18   243
## 5     2 c         8    18   260</code></pre>
</div>
<div id="data.table-5" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, .(SumA=sum(valA), SumB = sum(valB)), by=list(id,code) ] </code></pre>
<pre><code>##    id code SumA SumB
## 1:  1    a    7   34
## 2:  1    c    8   28
## 3:  2    a   13   31
## 4:  2    c    8   18
## 5:  2    b    9   18</code></pre>
</div>
</div>
<div id="question-7" class="section level3">
<h3>Question 7</h3>
<p><em>Get sum(valA) and sum(valB) grouped by id for id &gt;= 2 &amp; code %in% c(“a”, “c”)</em></p>
<div id="base-2" class="section level4">
<h4>base</h4>
<pre class="r"><code>aggregate(.~ id , subset(DF1, id &gt;=2 &amp; code %in% c(&quot;a&quot;,&quot;c&quot;), -code), sum)</code></pre>
<pre><code>##   id valA valB valC
## 1  2   21   49  656</code></pre>
</div>
<div id="dplyr-6" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% 
  group_by(id) %&gt;% 
  filter(id &gt;=2, code %in% c(&quot;a&quot;, &quot;c&quot;)) %&gt;% 
  select(-code, -valC) %&gt;% 
  summarise_all(sum)</code></pre>
<pre><code>## # A tibble: 1 x 3
##      id  valA  valB
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1     2    21    49</code></pre>
</div>
<div id="data.table-6" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[ (id&gt;=2) &amp; code %in% c(&quot;a&quot;, &quot;c&quot;) , .(SumA=sum(valA), SumB = sum(valB)), by=id ] </code></pre>
<pre><code>##    id SumA SumB
## 1:  2   21   49</code></pre>
</div>
</div>
<div id="question-8" class="section level3">
<h3>Question 8</h3>
<p><em>Replace valA with max(valA)-min(valA) grouped by code</em></p>
<div id="base-3" class="section level4">
<h4>base</h4>
<pre class="r"><code>DF1 &lt;- transform(DF1, valA = rep(tapply(valA, code, function(x) diff(range(x)))[code]))
DF1</code></pre>
<pre><code>##   id code valA valB valC
## 1  1    a    6   10   99
## 2  1    a    6   11  117
## 3  1    c    5   13  160
## 4  1    a    6   13  153
## 5  1    c    5   15  200
## 6  2    a    6   15  189
## 7  2    a    6   16  207
## 8  2    c    5   18  260
## 9  2    b    0   18  243</code></pre>
</div>
<div id="dplyr-7" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- TB1 %&gt;% group_by(code) %&gt;% mutate(valA= max(valA)-min(valA))
TB1</code></pre>
<pre><code>## # A tibble: 9 x 5
## # Groups:   code [3]
##      id code   valA  valB  valC
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 a         6    10    99
## 2     1 a         6    11   117
## 3     1 c         5    13   160
## 4     1 a         6    13   153
## 5     1 c         5    15   200
## 6     2 a         6    15   189
## 7     2 a         6    16   207
## 8     2 c         5    18   260
## 9     2 b         0    18   243</code></pre>
</div>
<div id="data.table-7" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, &quot;valA&quot; := max(valA)-min(valA), by=code] 
DT1</code></pre>
<pre><code>##    id code valA valB valC
## 1:  1    a    6   10   99
## 2:  1    a    6   11  117
## 3:  1    c    5   13  160
## 4:  1    a    6   13  153
## 5:  1    c    5   15  200
## 6:  2    a    6   15  189
## 7:  2    a    6   16  207
## 8:  2    c    5   18  260
## 9:  2    b    0   18  243</code></pre>
</div>
</div>
<div id="question-9" class="section level3">
<h3>Question 9</h3>
<p><em>Create a new col named valD with max(valB)-min(valA) grouped by code</em></p>
<div id="base-4" class="section level4">
<h4>base</h4>
<pre class="r"><code>DF1 &lt;- transform(DF1, valD = by(DF1, code, function(x) max(x$valB) - min(x$valA))[code])
DF1</code></pre>
<pre><code>##   id code valA valB valC valD
## 1  1    a    6   10   99   10
## 2  1    a    6   11  117   10
## 3  1    c    5   13  160   13
## 4  1    a    6   13  153   10
## 5  1    c    5   15  200   13
## 6  2    a    6   15  189   10
## 7  2    a    6   16  207   10
## 8  2    c    5   18  260   13
## 9  2    b    0   18  243   18</code></pre>
</div>
<div id="dplyr-8" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 &lt;- TB1 %&gt;% group_by(code) %&gt;% mutate(valD= max(valB)-min(valA))
TB1</code></pre>
<pre><code>## # A tibble: 9 x 6
## # Groups:   code [3]
##      id code   valA  valB  valC  valD
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 a         6    10    99    10
## 2     1 a         6    11   117    10
## 3     1 c         5    13   160    13
## 4     1 a         6    13   153    10
## 5     1 c         5    15   200    13
## 6     2 a         6    15   189    10
## 7     2 a         6    16   207    10
## 8     2 c         5    18   260    13
## 9     2 b         0    18   243    18</code></pre>
</div>
<div id="data.table-8" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT1[, &quot;valD&quot; := max(valB)-min(valA), by=code] 
DT1</code></pre>
<pre><code>##    id code valA valB valC valD
## 1:  1    a    6   10   99   10
## 2:  1    a    6   11  117   10
## 3:  1    c    5   13  160   13
## 4:  1    a    6   13  153   10
## 5:  1    c    5   15  200   13
## 6:  2    a    6   15  189   10
## 7:  2    a    6   16  207   10
## 8:  2    c    5   18  260   13
## 9:  2    b    0   18  243   18</code></pre>
</div>
</div>
<div id="question-10" class="section level3">
<h3>Question 10</h3>
<p><em>Subset DF1 by DF2 on id,code column. That is, for each row of DF2$id, DF2$code, get valA and valB cols from DF1. Include rows that have no matches as well.</em></p>
<div id="base-5" class="section level4">
<h4>base</h4>
<pre class="r"><code>merge(DF1, DF2[, c(&quot;id&quot;, &quot;code&quot;)], by = c(&quot;id&quot;, &quot;code&quot;), all.y=TRUE)</code></pre>
<pre><code>##   id code valA valB valC valD
## 1  1    a    6   13  153   10
## 2  1    a    6   10   99   10
## 3  1    a    6   11  117   10
## 4  1    c    5   13  160   13
## 5  1    c    5   15  200   13
## 6  2    c    5   18  260   13
## 7  3    b   NA   NA   NA   NA
## 8  3    d   NA   NA   NA   NA</code></pre>
</div>
<div id="dplyr-9" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>right_join(TB1, TB2 %&gt;% select(id, code), by = c(&quot;id&quot;, &quot;code&quot;)) </code></pre>
<pre><code>## # A tibble: 8 x 6
## # Groups:   code [4]
##      id code   valA  valB  valC  valD
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3 b        NA    NA    NA    NA
## 2     1 a         6    10    99    10
## 3     1 a         6    11   117    10
## 4     1 a         6    13   153    10
## 5     1 c         5    13   160    13
## 6     1 c         5    15   200    13
## 7     2 c         5    18   260    13
## 8     3 d        NA    NA    NA    NA</code></pre>
<pre class="r"><code>## inner_join to keep only rows present in tibbles, left_join to keep all rows from TB1
## anti_join to keep only rows from TB1 with no matching rows in TB2</code></pre>
</div>
<div id="data.table-9" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>merge(DT1, DT2[ , .(id, code)], all.y = TRUE)</code></pre>
<pre><code>##    id code valA valB valC valD
## 1:  1    a    6   10   99   10
## 2:  1    a    6   11  117   10
## 3:  1    a    6   13  153   10
## 4:  1    c    5   13  160   13
## 5:  1    c    5   15  200   13
## 6:  2    c    5   18  260   13
## 7:  3    b   NA   NA   NA   NA
## 8:  3    d   NA   NA   NA   NA</code></pre>
</div>
</div>
<div id="question-11" class="section level3">
<h3>Question 11</h3>
<p><em>Same as (10), but fetch just the first matching row of DF1 for each row of DF2$id, DF2$code. Exclude non-matching rows.</em></p>
<div id="base-6" class="section level4">
<h4>base</h4>
<pre class="r"><code>merge(DF1[!duplicated(DF1[, c(&quot;id&quot;, &quot;code&quot;)]), ],
      DF2[, c(&quot;id&quot;, &quot;code&quot;)], by = c(&quot;id&quot;, &quot;code&quot;))</code></pre>
<pre><code>##   id code valA valB valC valD
## 1  1    a    6   10   99   10
## 2  1    c    5   13  160   13
## 3  2    c    5   18  260   13</code></pre>
</div>
<div id="dplyr-10" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>TB1 %&gt;% group_by(id, code) %&gt;% slice(1) %&gt;% ## first entry in each (id, code) group
  inner_join(select(TB2, id, code), by = c(&quot;id&quot;, &quot;code&quot;))</code></pre>
<pre><code>## # A tibble: 3 x 6
## # Groups:   id, code [3]
##      id code   valA  valB  valC  valD
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1 a         6    10    99    10
## 2     1 c         5    13   160    13
## 3     2 c         5    18   260    13</code></pre>
</div>
<div id="data.table-10" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>merge(DT1[, .SD[1], by = list(id, code)], ## first entry in each (id, code) group
      DT2[ , .(id, code)])</code></pre>
<pre><code>##    id code valA valB valC valD
## 1:  1    a    6   10   99   10
## 2:  1    c    5   13  160   13
## 3:  2    c    5   18  260   13</code></pre>
</div>
</div>
<div id="question-12" class="section level3">
<h3>Question 12</h3>
<p><em>For every row of DF2$id, DF2$code that matches with DF1’s, update valA with valA*mul.</em></p>
<div id="base-7" class="section level4">
<h4>base</h4>
<pre class="r"><code>transform(merge(DF1, DF2, by = c(&quot;id&quot;, &quot;code&quot;), all.y=TRUE), valA = valA * mul)</code></pre>
<pre><code>##   id code valA valB valC valD mul
## 1  1    a   24   13  153   10   4
## 2  1    a   24   10   99   10   4
## 3  1    a   24   11  117   10   4
## 4  1    c   15   13  160   13   3
## 5  1    c   15   15  200   13   3
## 6  2    c   10   18  260   13   2
## 7  3    b   NA   NA   NA   NA   5
## 8  3    d   NA   NA   NA   NA   1</code></pre>
</div>
<div id="dplyr-11" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>right_join(TB1, TB2, by = c(&quot;id&quot;, &quot;code&quot;)) %&gt;% mutate(valA = valA * mul)</code></pre>
<pre><code>## # A tibble: 8 x 7
## # Groups:   code [4]
##      id code   valA  valB  valC  valD   mul
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1     3 b        NA    NA    NA    NA     5
## 2     1 a        24    10    99    10     4
## 3     1 a        24    11   117    10     4
## 4     1 a        24    13   153    10     4
## 5     1 c        15    13   160    13     3
## 6     1 c        15    15   200    13     3
## 7     2 c        10    18   260    13     2
## 8     3 d        NA    NA    NA    NA     1</code></pre>
</div>
<div id="data.table-11" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>DT3 &lt;- merge(DT1, DT2, all.y = TRUE)[ , &quot;valA&quot; := valA * mul]
show(DT3) ## je ne comprends pas pourquoi il faut utiliser show pour l&#39;affichage</code></pre>
<pre><code>##    id code valA valB valC valD mul
## 1:  1    a   24   10   99   10   4
## 2:  1    a   24   11  117   10   4
## 3:  1    a   24   13  153   10   4
## 4:  1    c   15   13  160   13   3
## 5:  1    c   15   15  200   13   3
## 6:  2    c   10   18  260   13   2
## 7:  3    b   NA   NA   NA   NA   5
## 8:  3    d   NA   NA   NA   NA   1</code></pre>
</div>
</div>
<div id="question-13" class="section level3">
<h3>Question 13</h3>
<p><em>Add a new column val to DF1 with values from DF2$mul where DF2$id, DF2$code matches with DF1’s. Rows that don’t match should have NA.</em></p>
<div id="base-8" class="section level4">
<h4>base</h4>
<pre class="r"><code>transform(merge(DF1, DF2, by = c(&quot;id&quot;, &quot;code&quot;), all.x = TRUE, sort = FALSE), mul = mul)</code></pre>
<pre><code>##   id code valA valB valC valD mul
## 1  1    a    6   13  153   10   4
## 2  1    a    6   10   99   10   4
## 3  1    a    6   11  117   10   4
## 4  1    c    5   13  160   13   3
## 5  1    c    5   15  200   13   3
## 6  2    c    5   18  260   13   2
## 7  2    b    0   18  243   18  NA
## 8  2    a    6   15  189   10  NA
## 9  2    a    6   16  207   10  NA</code></pre>
</div>
<div id="dplyr-12" class="section level4">
<h4>dplyr</h4>
<pre class="r"><code>left_join(TB1, TB2, by = c(&quot;id&quot;, &quot;code&quot;))</code></pre>
<pre><code>## # A tibble: 9 x 7
## # Groups:   code [3]
##      id code   valA  valB  valC  valD   mul
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1     1 a         6    10    99    10     4
## 2     1 a         6    11   117    10     4
## 3     1 c         5    13   160    13     3
## 4     1 a         6    13   153    10     4
## 5     1 c         5    15   200    13     3
## 6     2 a         6    15   189    10    NA
## 7     2 a         6    16   207    10    NA
## 8     2 c         5    18   260    13     2
## 9     2 b         0    18   243    18    NA</code></pre>
</div>
<div id="data.table-12" class="section level4">
<h4>data.table</h4>
<pre class="r"><code>merge(DT1, DT2, all.x = TRUE)</code></pre>
<pre><code>##    id code valA valB valC valD mul
## 1:  1    a    6   10   99   10   4
## 2:  1    a    6   11  117   10   4
## 3:  1    a    6   13  153   10   4
## 4:  1    c    5   13  160   13   3
## 5:  1    c    5   15  200   13   3
## 6:  2    a    6   15  189   10  NA
## 7:  2    a    6   16  207   10  NA
## 8:  2    b    0   18  243   18  NA
## 9:  2    c    5   18  260   13   2</code></pre>
</div>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="label label-default" href="/tags/tidy/">tidy</a>
  
  <a class="label label-default" href="/tags/data.table/">data.table</a>
  
  <a class="label label-default" href="/tags/dplyr/">dplyr</a>
  
</div>




    
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">

    
    <p class="powered-by">
      <a href="/privacy/">Privacy Policy</a>
    </p>
    

    <p class="powered-by">

      &copy; 2018 State of the R &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        CommonHTML: { linebreaks: { automatic: true } },
        tex2jax: { inlineMath: [ ['$', '$'], ['\\(','\\)'] ], displayMath: [ ['$$','$$'], ['\\[', '\\]'] ], processEscapes: false },
        TeX: { noUndefined: { attributes: { mathcolor: 'red', mathbackground: '#FFEEEE', mathsize: '90%' } } },
        messageStyle: 'none'
      });
    </script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    <script src="/js/hugo-academic.js"></script>
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    

    
    

    
    

  </body>
</html>

